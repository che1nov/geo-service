{
  "info": {
    "_postman_id": "e1c4f2d0-6a6b-4e2d-9e2c-0a2d8e3f7e1d",
    "name": "Geo Service API Tests",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Тесты для эндпоинтов геосервиса с авторизацией через JWT"
  },
  "item": [
    {
      "name": "Регистрация пользователя",
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\"username\":\"testuser\",\"password\":\"123456\"}"
        },
        "url": {
          "raw": "http://localhost:8080/api/auth/register",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "auth", "register"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Регистрация успешна\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.json()).to.haveOwnProperty('id');",
              "    pm.expect(pm.response.json()).to.haveOwnProperty('username');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Авторизация пользователя",
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\"username\":\"testuser\",\"password\":\"123456\"}"
        },
        "url": {
          "raw": "http://localhost:8080/api/auth/login",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "auth", "login"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Авторизация успешна\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.json()).to.haveOwnProperty('token');",
              "});",
              "",
              "const response = pm.response.json();",
              "pm.environment.set(\"token\", response.token);",
              "pm.globals.set(\"user_id\", response.user_id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Поиск адреса (Авторизованный)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"query\":\"Москва\"}"
        },
        "url": {
          "raw": "http://localhost:8080/api/address/search",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "address", "search"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Успешный поиск\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.json()).to.haveOwnProperty('addresses');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Геокодирование (Авторизованный)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"lat\":55.7558,\"lng\":37.6173}"
        },
        "url": {
          "raw": "http://localhost:8080/api/address/geocode",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "address", "geocode"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Успешное геокодирование\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.json()).to.haveOwnProperty('addresses');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Тест без токена",
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "raw",
          "raw": "{\"query\":\"Москва\"}"
        },
        "url": {
          "raw": "http://localhost:8080/api/address/search",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "address", "search"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Отказ без токена\", function () {",
              "    pm.response.to.have.status(401);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Тест с неверным токеном",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer invalid_token" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\"query\":\"Москва\"}"
        },
        "url": {
          "raw": "http://localhost:8080/api/address/search",
          "host": ["localhost"],
          "port": "8080",
          "path": ["api", "address", "search"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Отказ с неверным токеном\", function () {",
              "    pm.response.to.have.status(401);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Метрики сервиса",
      "request": {
        "method": "GET",
        "header": [],
        "body": {
          "mode": "raw"
        },
        "url": {
          "raw": "http://localhost:8080/metrics",
          "host": ["localhost"],
          "port": "8080",
          "path": ["metrics"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Метрики доступны\", function () {",
              "    pm.response.to.have.status(200);",
              "    pm.expect(pm.response.text()).to.include(\"# TYPE\");",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "variable": []
}